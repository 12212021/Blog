### 浏览器的发展历史
早期的浏览器大部分采用单进程、多线程的架构，在这种架构下面，浏览器存在一些问题：
- 不稳定：早期浏览器需要借助插件，插件一旦崩溃，单进程的架构会导致整个浏览器的崩溃
- 不流畅：在单进程的架构中，js执行和插件等在一个线程中执行，会使得浏览器卡顿，同时内存泄露也会导致浏览器卡顿
- 不安全：js脚本运行在单进程的浏览器中，可以读取浏览器进程的相关数据，不安全。
chrome浏览器在08年发布的时候采用了多进程的架构，能够很好地解决单进程浏览器存在的问题
- 不稳定：同站点的页面被采用一个进程，该站点页面崩溃之后不影响其他tab的使用
- 不流畅：js在渲染进程中运行，即使发生阻塞，也仅仅影响相关的tab页面，不会造成整个浏览器卡顿
- 不安全：js的解释运行被限制在沙箱状态下的”渲染进程“中，不能访问浏览器的一些核心数据

chrome浏览器采用多进程不是没有代价的，代价是浏览器的实现更加复杂，需要通过IPC进行进程之间的通信交互；同时会占用更多的内存。

### chrome浏览器架构变化：
早期chrome浏览器的架构：
![image.png](https://i.loli.net/2019/12/17/mIGAVZ8BW5NRdc1.png)

最新的chrome浏览器架构：
![image.png](https://i.loli.net/2019/12/17/NqHdUA3WCs9rbyK.png)

浏览器未来的架构：
![image.png](https://i.loli.net/2019/12/17/ljgMh2s1ayLSZRK.png)

进程相关功能简介：
- 浏览器主进程： 负责界面的展示（回退、刷新等按钮）、用户交互、子进程管理、存储等功能
- 渲染进程：核心人物是将HTML、css、js转化为可以交互的网页（排版引擎Blink V8都运行在该进程），*处于安全考虑*，渲染进程运行在沙箱模式下面
- GPU进程：3D CSS效果，网页、chrome UI界面的绘制
- 网络进程：负责页面网络资源的加载
- 插件进程：负责插件的运行


### 浏览器的渲染过程
![image.png](https://i.loli.net/2019/12/17/bQ8qSXxYH9zo346.png)
- 构建DOM树：将html转化为内存中的DOM树结构
- 计算样式
    - 将link、style标签、style行内的元素的样式转化为StyleSheets
    - 将StyleSheets中的css标准化
    - 根据css的层叠规则和继承规则，计算DOM树每个节点的样式
- 布局计算
    - 创建布局树：包含可见DOM元素的树（不包含head等标签，display：none也不包含）
    - 进行布局运算，计算布局树节点的坐标位置
- 分层计算：渲染引擎需要为特定的节点生成专用的图层，并对应一颗图层树（LayerTree）
    - 拥有层叠上下文属性的元素会被提升为单独的一层
    - 需要裁减的（clip）地方会创建为图层
    - 用过chrome浏览器的layer工具可以查看图层
- 图层绘制：浏览器会根据图层树生成一些列的小的绘制指令，将这些指令按照顺序组成一个待绘制的列表。
- 栅格化（raster）操作：将图块转化为位图
    - 渲染进行中的合称线程根据待绘制列表中的指令绘制
    - 合称线程将图层树分成图块（tile），优先绘制视口附近的图块
    - 合称线程将视口附近的图块优先生成位图
    - 栅格化一般是在GPU中完成的
- 合成和显示
    - 所有图块都被光栅化之后，合称线程会生成一个绘制图块的命令-”DrawQuad“，由浏览器主进程将页面内容绘制到内存，最后显示到屏幕上

### 渲染一些重要的概念
更新元素的几何属性（重排）
![image.png](https://i.loli.net/2019/12/17/2yb7fS3QRwokHhs.png)
更新元素的绘制属性（重绘）
![imgae.png](https://i.loli.net/2019/12/17/RtdhY4FJVkcx3KC.png)
直接合成阶段
![image.png](https://i.loli.net/2019/12/17/MnbIPENqt1cVyeG.png)